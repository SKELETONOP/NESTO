<header class="relative z-50">
  <nav
    class="bg-white/10 backdrop-blur-xl border-b border-white/20 text-white px-4 py-4 shadow-2xl relative"
  >
    <!-- Gradient overlay for extra depth -->
    <div
      class="absolute inset-0 bg-gradient-to-r from-purple-500/10 via-pink-500/5 to-blue-500/10 rounded-lg"
    ></div>

    <div class="flex justify-between items-center relative z-10">
      <!-- Logo with gradient -->
      <div class="text-2xl sm:text-3xl font-bold">
        <a
          href="/"
          class="bg-gradient-to-r from-orange-400 to-pink-400 bg-clip-text text-transparent hover:from-orange-300 hover:to-pink-300 transition-all duration-300 transform hover:scale-105"
        >
          Nesto
        </a>
      </div>

      <!-- Desktop Navigation -->
      <div
        class="hidden text-sm md:text-sm lg:text-base md:flex space-x-2 lg:space-x-3 items-center"
      >
        <% if (isLoggedIn) { %> <% if (user && user.userType === 'guest') { %>
        <a
          href="/"
          class="px-4 lg:px-6 py-2 lg:py-3 rounded-xl shadow-sm transition-all duration-300 ease-in-out transform hover:scale-105 <%= activeTab === 'home' ? 'bg-gradient-to-r from-orange-400 to-pink-400 text-white shadow-lg shadow-orange-500/25' : 'bg-white/10 text-white/90 border border-white/20 hover:bg-white/20 hover:border-orange-400/50 hover:text-orange-300' %> focus:outline-none focus:ring-2 focus:ring-orange-400/50"
        >
          üè† Home
        </a>

        <a
          href="/store/bookings"
          class="px-4 lg:px-6 py-2 lg:py-3 rounded-xl shadow-sm transition-all duration-300 ease-in-out transform hover:scale-105 <%= activeTab === 'bookings' ? 'bg-gradient-to-r from-orange-400 to-pink-400 text-white shadow-lg shadow-orange-500/25' : 'bg-white/10 text-white/90 border border-white/20 hover:bg-white/20 hover:border-orange-400/50 hover:text-orange-300' %> focus:outline-none focus:ring-2 focus:ring-orange-400/50"
        >
          üìÖ Bookings
        </a>
        <a
          href="/store/favourites"
          class="px-4 lg:px-6 py-2 lg:py-3 rounded-xl shadow-sm transition-all duration-300 ease-in-out transform hover:scale-105 <%= activeTab === 'favourites' ? 'bg-gradient-to-r from-orange-400 to-pink-400 text-white shadow-lg shadow-orange-500/25' : 'bg-white/10 text-white/90 border border-white/20 hover:bg-white/20 hover:border-orange-400/50 hover:text-orange-300' %> focus:outline-none focus:ring-2 focus:ring-orange-400/50"
        >
          ‚ù§Ô∏è Favourites
        </a>
        <% } else if (user && user.userType === 'host') { %>
        <a
          href="/host/add-home"
          class="px-4 lg:px-6 py-2 lg:py-3 rounded-xl shadow-sm transition-all duration-300 ease-in-out transform hover:scale-105 <%= activeTab === 'add-home' ? 'bg-gradient-to-r from-orange-400 to-pink-400 text-white shadow-lg shadow-orange-500/25' : 'bg-white/10 text-white/90 border border-white/20 hover:bg-white/20 hover:border-orange-400/50 hover:text-orange-300' %> focus:outline-none focus:ring-2 focus:ring-orange-400/50"
        >
          ‚ûï Add Home
        </a>
        <a
          href="/host/host-home-list"
          class="px-4 lg:px-6 py-2 lg:py-3 rounded-xl shadow-sm transition-all duration-300 ease-in-out transform hover:scale-105 <%= activeTab === 'host-homes' ? 'bg-gradient-to-r from-orange-400 to-pink-400 text-white shadow-lg shadow-orange-500/25' : 'bg-white/10 text-white/90 border border-white/20 hover:bg-white/20 hover:border-orange-400/50 hover:text-orange-300' %> focus:outline-none focus:ring-2 focus:ring-orange-400/50"
        >
          üè° Host Homes
        </a>
        <% } %> <% } %> <% if (!isLoggedIn) { %>
        <a
          href="/login"
          class="px-4 lg:px-6 py-2 lg:py-3 rounded-xl shadow-sm transition-all duration-300 ease-in-out transform hover:scale-105 <%= activeTab === 'login' ? 'bg-gradient-to-r from-orange-400 to-pink-400 text-white shadow-lg shadow-orange-500/25' : 'bg-white/10 text-white/90 border border-white/20 hover:bg-white/20 hover:border-orange-400/50 hover:text-orange-300' %> focus:outline-none focus:ring-2 focus:ring-orange-400/50"
        >
          üîë Login
        </a>
        <a
          href="/signup"
          class="px-4 lg:px-6 py-2 lg:py-3 rounded-xl shadow-sm transition-all duration-300 ease-in-out transform hover:scale-105 bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 text-white shadow-lg shadow-orange-500/25 focus:outline-none focus:ring-2 focus:ring-orange-400/50"
        >
          ‚ú® Sign Up
        </a>
        <% } else { %>
        <div class="relative inline-block text-left" x-data="{ open: false }" x-init="open = false">
  <!-- Trigger Button -->
  <button
    @click="open = !open"
    class="group flex items-center space-x-2 px-4 lg:px-6 py-2.5 lg:py-3 rounded-xl shadow-lg transition-all duration-300 ease-out transform hover:scale-105 bg-gradient-to-r from-indigo-500/20 to-purple-500/20 backdrop-blur-sm text-white/95 border border-white/20 hover:from-indigo-500/30 hover:to-purple-500/30 hover:border-white/30 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-indigo-400/50 focus:ring-offset-2 focus:ring-offset-transparent"
  >
    <div class="w-8 h-8 rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center text-sm font-semibold text-white shadow-sm">
      <%= user.firstName.charAt(0).toUpperCase() %>
    </div>
    <span class="font-medium"><%= user.firstName %></span>
    <svg class="w-4 h-4 transition-transform duration-200 group-hover:text-indigo-300" 
         :class="{ 'rotate-180': open }" 
         fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
    </svg>
  </button>

  <!-- Dropdown Menu -->
  <div
    x-show="open"
    x-cloak
    x-transition:enter="transition ease-out duration-200"
    x-transition:enter-start="opacity-0 scale-95 translate-y-1"
    x-transition:enter-end="opacity-100 scale-100 translate-y-0"
    x-transition:leave="transition ease-in duration-150"
    x-transition:leave-start="opacity-100 scale-100 translate-y-0"
    x-transition:leave-end="opacity-0 scale-95 translate-y-1"
    @click.away="open = false"
    class="absolute right-0 mt-3 w-56 bg-white/95 backdrop-blur-md rounded-2xl shadow-xl ring-1 ring-black/5 border border-white/20 z-50 overflow-hidden"
  >
    <!-- User Info Header -->
    <div class="px-4 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 border-b border-gray-100">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center text-white font-semibold shadow-sm">
          <%= user.firstName.charAt(0).toUpperCase() %>
        </div>
        <div>
          <p class="text-sm font-semibold text-gray-900"><%= user.firstName %></p>
          <p class="text-xs text-gray-500">Online</p>
        </div>
      </div>
    </div>

    <!-- Menu Items -->
    <div class="py-2">
      <a
        href="/profile"
        class="group flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 hover:text-indigo-600 transition-all duration-200 relative overflow-hidden"
      >
        <div class="w-8 h-8 rounded-lg bg-gray-100 group-hover:bg-indigo-100 flex items-center justify-center mr-3 transition-colors duration-200">
          <svg class="w-4 h-4 text-gray-500 group-hover:text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
        </div>
        <div>
          <p class="font-medium">Profile</p>
          <p class="text-xs text-gray-400 group-hover:text-indigo-400">View and edit profile</p>
        </div>
      </a>

      <a
        href="#"
        class="group flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 hover:text-indigo-600 transition-all duration-200 relative overflow-hidden"
      >
        <div class="w-8 h-8 rounded-lg bg-gray-100 group-hover:bg-indigo-100 flex items-center justify-center mr-3 transition-colors duration-200">
          <svg class="w-4 h-4 text-gray-500 group-hover:text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
        </div>
        <div>
          <p class="font-medium"><%= user.userType.toUpperCase() %></p>
          <p class="text-xs text-gray-400 group-hover:text-indigo-400">Account Type</p>
        </div>
      </a>

      <!-- Divider -->
      <div class="my-2 h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent"></div>

      <!-- Logout -->
      <form action="/logout" method="POST">
        <button
          type="submit"
          class="group w-full flex items-center px-4 py-3 text-sm text-red-600 hover:bg-gradient-to-r hover:from-red-50 hover:to-pink-50 hover:text-red-700 transition-all duration-200 relative overflow-hidden"
        >
          <div class="w-8 h-8 rounded-lg bg-red-50 group-hover:bg-red-100 flex items-center justify-center mr-3 transition-colors duration-200">
            <svg class="w-4 h-4 text-red-500 group-hover:text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
            </svg>
          </div>
          <div>
            <p class="font-medium">Sign out</p>
            <p class="text-xs text-red-400 group-hover:text-red-500">End your session</p>
          </div>
        </button>
      </form>
    </div>
  </div>
</div>
        <% } %>
      </div>

      <!-- Mobile menu button with glassmorphism -->
      <button
        id="menu-toggle"
        class="md:hidden text-white focus:outline-none text-2xl p-2 rounded-xl bg-white/10 border border-white/20 hover:bg-white/20 transition-all duration-300 transform hover:scale-110 focus:ring-2 focus:ring-orange-400/50"
      >
        <span id="menu-icon">‚ò∞</span>
      </button>
    </div>

    <!-- Mobile Navigation with smooth animation -->
    <div
      id="menu"
      class="mt-4 space-y-3 flex-col md:hidden hidden opacity-0 transform -translate-y-4 transition-all duration-300 ease-out"
    >
      <% if (isLoggedIn) { %> <% if (user && user.userType === 'guest') { %>
      <a
        href="/"
        class="block px-4 py-3 rounded-xl transition-all duration-300 ease-in-out transform hover:scale-105 <%= activeTab === 'home' ? 'bg-gradient-to-r from-orange-400 to-pink-400 text-white shadow-lg' : 'bg-white/10 text-white/90 border border-white/20 hover:bg-white/20 hover:border-orange-400/50 hover:text-orange-300' %>"
      >
        üè† Home
      </a>

      <a
        href="/store/bookings"
        class="block px-4 py-3 rounded-xl transition-all duration-300 ease-in-out transform hover:scale-105 <%= activeTab === 'bookings' ? 'bg-gradient-to-r from-orange-400 to-pink-400 text-white shadow-lg' : 'bg-white/10 text-white/90 border border-white/20 hover:bg-white/20 hover:border-orange-400/50 hover:text-orange-300' %>"
      >
        üìÖ Bookings
      </a>
      <a
        href="/store/favourites"
        class="block px-4 py-3 rounded-xl transition-all duration-300 ease-in-out transform hover:scale-105 <%= activeTab === 'favourites' ? 'bg-gradient-to-r from-orange-400 to-pink-400 text-white shadow-lg' : 'bg-white/10 text-white/90 border border-white/20 hover:bg-white/20 hover:border-orange-400/50 hover:text-orange-300' %>"
      >
        ‚ù§Ô∏è My Favourites
      </a>
      <% } else if (user && user.userType === 'host') { %>
      <a
        href="/host/host-home-list"
        class="block px-4 py-3 rounded-xl transition-all duration-300 ease-in-out transform hover:scale-105 <%= activeTab === 'host-homes' ? 'bg-gradient-to-r from-orange-400 to-pink-400 text-white shadow-lg' : 'bg-white/10 text-white/90 border border-white/20 hover:bg-white/20 hover:border-orange-400/50 hover:text-orange-300' %>"
      >
        üè° Host Homes
      </a>
      <a
        href="/host/add-home"
        class="block px-4 py-3 rounded-xl transition-all duration-300 ease-in-out transform hover:scale-105 <%= activeTab === 'add-home' ? 'bg-gradient-to-r from-orange-400 to-pink-400 text-white shadow-lg' : 'bg-white/10 text-white/90 border border-white/20 hover:bg-white/20 hover:border-orange-400/50 hover:text-orange-300' %>"
      >
        ‚ûï Add Home
      </a>
      <% } %> <% } %> <% if (!isLoggedIn) { %>
      <a
        href="/login"
        class="block px-4 py-3 rounded-xl transition-all duration-300 ease-in-out transform hover:scale-105 <%= activeTab === 'login' ? 'bg-gradient-to-r from-orange-400 to-pink-400 text-white shadow-lg' : 'bg-white/10 text-white/90 border border-white/20 hover:bg-white/20 hover:border-orange-400/50 hover:text-orange-300' %>"
      >
        üîë Login
      </a>
      <a
        href="/signup"
        class="block px-4 py-3 rounded-xl transition-all duration-300 ease-in-out transform hover:scale-105 bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 text-white shadow-lg shadow-orange-500/25"
      >
        ‚ú® Sign Up
      </a>
      <% } else { %>
      <div class="relative inline-block text-left w-full sm:w-auto" x-data="{ open: false }" x-init="open = false">
  <!-- Trigger Button -->
  <button
    @click="open = !open"
    class="group flex items-center justify-between sm:justify-start w-full sm:w-auto space-x-2 px-4 sm:px-6 py-2.5 sm:py-3 rounded-xl shadow-lg transition-all duration-300 ease-out transform hover:scale-105 bg-gradient-to-r from-indigo-500/20 to-purple-500/20 backdrop-blur-sm text-white/95 border border-white/20 hover:from-indigo-500/30 hover:to-purple-500/30 hover:border-white/30 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-indigo-400/50 focus:ring-offset-2 focus:ring-offset-transparent"
  >
  <div class="flex items-center space-x-2">
    <div class="w-8 h-8 rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center text-sm font-semibold text-white shadow-sm">
      <%= user.firstName.charAt(0).toUpperCase() %>
    </div>
    <span class="font-medium text-sm sm:text-base text-white"><%= user.firstName %></span>
    </div>
    <svg class="w-4 h-4 transition-transform duration-200 group-hover:text-indigo-300" 
         :class="{ 'rotate-180': open }" 
         fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
    </svg>
  </button>

  <!-- Dropdown Menu -->
  <div
    x-show="open"
    x-cloak
    x-transition:enter="transition ease-out duration-200"
    x-transition:enter-start="opacity-0 scale-95 translate-y-1"
    x-transition:enter-end="opacity-100 scale-100 translate-y-0"
    x-transition:leave="transition ease-in duration-150"
    x-transition:leave-start="opacity-100 scale-100 translate-y-0"
    x-transition:leave-end="opacity-0 scale-95 translate-y-1"
    @click.away="open = false"
    class="absolute right-0 mt-2 w-full sm:w-64 bg-white/95 backdrop-blur-md rounded-2xl shadow-xl ring-1 ring-black/5 border border-white/20 z-50 overflow-hidden"
  >
    <!-- User Info Header -->
    <div class="px-4 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 border-b border-gray-100">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center text-white font-semibold shadow-sm">
          <%= user.firstName.charAt(0).toUpperCase() %>
        </div>
        <div>
          <p class="text-sm font-semibold text-gray-900"><%= user.firstName %></p>
          <p class="text-xs text-gray-500">Online</p>
        </div>
      </div>
    </div>

    <!-- Menu Items -->
    <div class="py-2">
      <a href="/profile" class="group flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 hover:text-indigo-600 transition-all duration-200">
        <div class="w-8 h-8 rounded-lg bg-gray-100 group-hover:bg-indigo-100 flex items-center justify-center mr-3">
          <svg class="w-4 h-4 text-gray-500 group-hover:text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
        </div>
        <div>
          <p class="font-medium">Profile</p>
          <p class="text-xs text-gray-400 group-hover:text-indigo-400">View and edit profile</p>
        </div>
      </a>

      <a href="#" class="group flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 hover:text-indigo-600 transition-all duration-200">
        <div class="w-8 h-8 rounded-lg bg-gray-100 group-hover:bg-indigo-100 flex items-center justify-center mr-3">
          <svg class="w-4 h-4 text-gray-500 group-hover:text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0..."/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
        </div>
        <div>
          <p class="font-medium"><%= user.userType.toUpperCase() %></p>
          <p class="text-xs text-gray-400 group-hover:text-indigo-400">Account Type</p>
        </div>
      </a>

      <div class="my-2 h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent"></div>

      <!-- Logout -->
      <form action="/logout" method="POST">
        <button type="submit" class="group w-full flex items-center px-4 py-3 text-sm text-red-600 hover:bg-gradient-to-r hover:from-red-50 hover:to-pink-50 hover:text-red-700 transition-all duration-200">
          <div class="w-8 h-8 rounded-lg bg-red-50 group-hover:bg-red-100 flex items-center justify-center mr-3">
            <svg class="w-4 h-4 text-red-500 group-hover:text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1..."/>
            </svg>
          </div>
          <div>
            <p class="font-medium">Sign out</p>
            <p class="text-xs text-red-400 group-hover:text-red-500">End your session</p>
          </div>
        </button>
      </form>
    </div>
  </div>
</div>

      <% } %>
    </div>
  </nav>
</header>

<script>
  const toggleBtn = document.getElementById("menu-toggle");
  const menu = document.getElementById("menu");
  const menuIcon = document.getElementById("menu-icon");

  toggleBtn.addEventListener("click", () => {
    const isHidden = menu.classList.contains("hidden");

    if (isHidden) {
      // Show menu
      menu.classList.remove("hidden");
      setTimeout(() => {
        menu.classList.remove("opacity-0", "-translate-y-4");
        menu.classList.add("opacity-100", "translate-y-0");
      }, 10);
      menuIcon.textContent = "‚úï";
      toggleBtn.classList.add("rotate-180");
    } else {
      // Hide menu
      menu.classList.remove("opacity-100", "translate-y-0");
      menu.classList.add("opacity-0", "-translate-y-4");
      setTimeout(() => {
        menu.classList.add("hidden");
      }, 300);
      menuIcon.textContent = "‚ò∞";
      toggleBtn.classList.remove("rotate-180");
    }
  });

  // Add stagger animation to menu items
  const menuItems = menu.querySelectorAll("a, button");
  menuItems.forEach((item, index) => {
    item.style.transitionDelay = `${index * 50}ms`;
  });

  // Add smooth scroll behavior
  document.documentElement.style.scrollBehavior = "smooth";
</script>

<style>
  /* Custom animations */
  .rotate-180 {
    transform: rotate(180deg);
    transition: transform 0.3s ease;
  }

  /* Ensure backdrop blur works */
  .backdrop-blur-xl {
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }

  /* Enhanced hover effects */
  nav a:hover,
  nav button:hover {
    box-shadow: 0 8px 32px rgba(251, 146, 60, 0.2);
  }

  /* Mobile menu animation improvements */
  #menu {
    transform-origin: top;
  }

  /* Logo hover effect */
  nav a[href="/store/index"]:hover {
    text-shadow: 0 0 20px rgba(251, 146, 60, 0.5);
  }
</style>
